<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dropdown Demo - Working Example</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 60px 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .demo-container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      margin-bottom: 10px;
      color: #0b3d3e;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    /* Dropdown Styles */
    .dropdown-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
      margin-bottom: 20px;
    }

    .dropdown-trigger {
      width: 100%;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 16px;
      background: #0b3d3e;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-family: inherit;
      transition: background 0.2s;
    }

    .dropdown-trigger:hover {
      background: #0d4a4c;
    }

    .dropdown-trigger:focus {
      outline: 2px solid #38e0b1;
      outline-offset: 2px;
    }

    .dropdown-selected-text {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .dropdown-arrow {
      font-size: 20px;
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }

    .dropdown-trigger.dropdown-open .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      padding: 4px 0;
      overflow: hidden;
      overflow-y: auto;
      max-height: 300px;
      z-index: 1000;
    }

    .dropdown-menu::-webkit-scrollbar {
      width: 8px;
    }

    .dropdown-menu::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    .dropdown-menu::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 4px;
    }

    .dropdown-menu::-webkit-scrollbar-thumb:hover {
      background: #999;
    }

    .dropdown-item {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
      font-size: 16px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
      outline: none;
      position: relative;
    }

    .dropdown-item:hover,
    .dropdown-item.is-focused {
      background: #f5f5f5;
    }

    .dropdown-item.is-focused {
      outline: 2px solid #38e0b1;
      outline-offset: -2px;
    }

    .dropdown-item.is-active {
      background: #38e0b1;
      font-weight: 600;
      color: #0b3d3e;
      padding-right: 48px;
    }

    .dropdown-item.is-active::after {
      content: '‚úì';
      position: absolute;
      right: 16px;
      font-size: 16px;
      color: #0b3d3e;
      font-weight: 700;
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #38e0b1;
    }

    .result h3 {
      margin-bottom: 10px;
      color: #0b3d3e;
      font-size: 16px;
    }

    .result-value {
      font-family: monospace;
      color: #666;
      font-size: 14px;
    }

    .instructions {
      margin-top: 30px;
      padding: 20px;
      background: #fff9e6;
      border-radius: 8px;
      border-left: 4px solid #ffc107;
    }

    .instructions h3 {
      margin-bottom: 10px;
      color: #856404;
      font-size: 14px;
      font-weight: 600;
    }

    .instructions ul {
      margin-left: 20px;
      color: #666;
      font-size: 13px;
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <h1>‚ú® Dropdown Demo</h1>
    <p class="subtitle">Production-ready vanilla JavaScript dropdown</p>

    <label for="month">Select Month</label>
    <div class="dropdown-wrapper">
      <button 
        type="button"
        id="month-dropdown-trigger" 
        class="dropdown-trigger" 
        data-dropdown="month-dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <span class="dropdown-selected-text">Janu√°r</span>
        <span class="dropdown-arrow">‚ñº</span>
      </button>
      <input type="hidden" id="month" name="month" value="01">
      <div id="month-dropdown" class="dropdown-menu" role="menu">
        <div class="dropdown-item" data-value="01">Janu√°r</div>
        <div class="dropdown-item" data-value="02">Febru√°r</div>
        <div class="dropdown-item" data-value="03">M√°rcius</div>
        <div class="dropdown-item" data-value="04">√Åprilis</div>
        <div class="dropdown-item" data-value="05">M√°jus</div>
        <div class="dropdown-item" data-value="06">J√∫nius</div>
        <div class="dropdown-item" data-value="07">J√∫lius</div>
        <div class="dropdown-item" data-value="08">Augusztus</div>
        <div class="dropdown-item" data-value="09">Szeptember</div>
        <div class="dropdown-item" data-value="10">Okt√≥ber</div>
        <div class="dropdown-item" data-value="11">November</div>
        <div class="dropdown-item" data-value="12">December</div>
      </div>
    </div>

    <div class="result">
      <h3>Selected Value:</h3>
      <div class="result-value" id="result">01 - Janu√°r</div>
    </div>

    <div class="instructions">
      <h3>üéØ Try These:</h3>
      <ul>
        <li>Click the dropdown to open/close</li>
        <li>Use ‚Üë‚Üì arrow keys to navigate</li>
        <li>Press Enter or Space to select</li>
        <li>Press Escape to close</li>
        <li>Type "M" to jump to M√°jus</li>
        <li>Click outside to close</li>
      </ul>
    </div>
  </div>

  <script type="module">
    // Professional Dropdown Component
    class Dropdown {
      constructor() {
        this.dropdowns = new Map();
        this.activeDropdown = null;
        this.init();
      }

      init() {
        try {
          const triggers = document.querySelectorAll('[data-dropdown]');
          
          console.log(`üîç Found ${triggers.length} dropdown trigger(s)`);
          
          if (triggers.length === 0) {
            console.warn('‚ö†Ô∏è  No dropdown triggers found');
            return;
          }

          triggers.forEach(trigger => {
            const menuId = trigger.getAttribute('data-dropdown');
            const menu = document.getElementById(menuId);
            
            if (!menu) {
              console.error(`‚ùå Dropdown menu not found: #${menuId}`);
              return;
            }

            console.log(`‚úì Found menu #${menuId}, creating dropdown...`);
            this.createDropdown(trigger, menu);
          });

          this.bindGlobalEvents();
          
          console.log(`‚úÖ ${this.dropdowns.size} Dropdown(s) initialized!`);
        } catch (error) {
          console.error('‚ùå Error initializing dropdowns:', error);
        }
      }

      createDropdown(trigger, menu) {
        const wrapper = trigger.closest('.dropdown-wrapper');
        const hiddenInput = wrapper?.querySelector('input[type="hidden"]');
        const selectedTextEl = trigger.querySelector('.dropdown-selected-text');
        const items = Array.from(menu.querySelectorAll('.dropdown-item'));
        
        if (wrapper) {
          const wrapperPosition = window.getComputedStyle(wrapper).position;
          if (wrapperPosition === 'static') {
            wrapper.style.position = 'relative';
          }
        }
        
        const dropdown = {
          trigger,
          menu,
          wrapper,
          hiddenInput,
          selectedTextEl,
          items,
          isOpen: false,
          focusedIndex: -1,
          selectedIndex: 0
        };

        this.setupDropdown(dropdown);
        this.bindTriggerEvents(dropdown);
        this.bindItemEvents(dropdown);
        
        this.dropdowns.set(trigger, dropdown);
      }

      setupDropdown(dropdown) {
        const { menu, items, hiddenInput } = dropdown;
        
        menu.style.display = 'none';
        menu.style.position = 'absolute';
        menu.style.zIndex = '1000';
        menu.style.minWidth = '100px';
        menu.setAttribute('role', 'listbox');
        menu.setAttribute('tabindex', '-1');
        
        const initialValue = hiddenInput ? hiddenInput.value : items[0]?.getAttribute('data-value');
        
        items.forEach((item, index) => {
          item.setAttribute('role', 'option');
          item.setAttribute('tabindex', '-1');
          item.setAttribute('data-index', index);
          
          const itemValue = item.getAttribute('data-value');
          if (itemValue === initialValue) {
            item.classList.add('is-active');
            dropdown.selectedIndex = index;
          }
        });
      }

      bindTriggerEvents(dropdown) {
        const { trigger } = dropdown;
        
        trigger.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          this.toggle(dropdown);
        });

        trigger.addEventListener('keydown', (e) => {
          switch(e.key) {
            case 'Enter':
            case ' ':
            case 'ArrowDown':
            case 'ArrowUp':
              e.preventDefault();
              if (!dropdown.isOpen) {
                this.open(dropdown);
              }
              if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                this.focusItem(dropdown, 0);
              }
              break;
            case 'Escape':
              if (dropdown.isOpen) {
                e.preventDefault();
                this.close(dropdown);
              }
              break;
          }
        });
      }

      bindItemEvents(dropdown) {
        const { items } = dropdown;
        
        items.forEach((item, index) => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.selectItem(dropdown, index);
          });

          item.addEventListener('mouseenter', () => {
            this.focusItem(dropdown, index);
          });

          item.addEventListener('keydown', (e) => {
            this.handleItemKeydown(dropdown, e, index);
          });
        });
      }

      bindGlobalEvents() {
        document.addEventListener('click', (e) => {
          if (this.activeDropdown && !e.target.closest('.dropdown-wrapper')) {
            this.close(this.activeDropdown);
          }
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.activeDropdown) {
            this.close(this.activeDropdown);
          }
        });
      }

      handleItemKeydown(dropdown, e, currentIndex) {
        const { items } = dropdown;
        
        switch(e.key) {
          case 'ArrowDown':
            e.preventDefault();
            const nextIndex = (currentIndex + 1) % items.length;
            this.focusItem(dropdown, nextIndex);
            break;
            
          case 'ArrowUp':
            e.preventDefault();
            const prevIndex = (currentIndex - 1 + items.length) % items.length;
            this.focusItem(dropdown, prevIndex);
            break;
            
          case 'Enter':
          case ' ':
            e.preventDefault();
            this.selectItem(dropdown, currentIndex);
            break;
            
          case 'Escape':
            e.preventDefault();
            this.close(dropdown);
            break;
            
          default:
            if (key.length === 1) {
              this.handleTypeToSearch(dropdown, e.key);
            }
        }
      }

      handleTypeToSearch(dropdown, key) {
        const { items } = dropdown;
        const char = key.toLowerCase();
        const currentIndex = dropdown.focusedIndex;
        
        for (let i = currentIndex + 1; i < items.length; i++) {
          if (items[i].textContent.trim().toLowerCase().startsWith(char)) {
            this.focusItem(dropdown, i);
            return;
          }
        }
        
        for (let i = 0; i <= currentIndex; i++) {
          if (items[i].textContent.trim().toLowerCase().startsWith(char)) {
            this.focusItem(dropdown, i);
            return;
          }
        }
      }

      toggle(dropdown) {
        console.log(`üîÑ Toggle (currently ${dropdown.isOpen ? 'open' : 'closed'})`);
        if (dropdown.isOpen) {
          this.close(dropdown);
        } else {
          this.open(dropdown);
        }
      }

      open(dropdown) {
        const { trigger, menu } = dropdown;
        
        if (this.activeDropdown && this.activeDropdown !== dropdown) {
          this.close(this.activeDropdown);
        }
        
        this.positionMenu(dropdown);
        
        menu.style.display = 'block';
        menu.style.opacity = '0';
        menu.style.transform = 'translateY(-10px)';
        
        menu.offsetHeight;
        
        menu.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
        menu.style.opacity = '1';
        menu.style.transform = 'translateY(0)';
        
        dropdown.isOpen = true;
        this.activeDropdown = dropdown;
        
        trigger.setAttribute('aria-expanded', 'true');
        trigger.classList.add('dropdown-open');
        
        const indexToFocus = dropdown.selectedIndex >= 0 ? dropdown.selectedIndex : 0;
        this.focusItem(dropdown, indexToFocus);
        
        console.log('üîΩ Dropdown opened');
      }

      close(dropdown) {
        if (!dropdown || !dropdown.isOpen) return;
        
        const { trigger, menu } = dropdown;
        
        dropdown.isOpen = false;
        dropdown.focusedIndex = -1;
        
        trigger.setAttribute('aria-expanded', 'false');
        trigger.classList.remove('dropdown-open');
        
        menu.style.opacity = '0';
        menu.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
          menu.style.display = 'none';
        }, 200);
        
        trigger.focus();
        
        if (this.activeDropdown === dropdown) {
          this.activeDropdown = null;
        }
        
        console.log('üîº Dropdown closed');
      }

      focusItem(dropdown, index) {
        const { items, menu } = dropdown;
        
        if (index < 0 || index >= items.length) return;
        
        items.forEach(item => {
          item.classList.remove('is-focused');
          item.setAttribute('aria-selected', 'false');
        });
        
        const item = items[index];
        item.classList.add('is-focused');
        item.setAttribute('aria-selected', 'true');
        item.focus();
        
        dropdown.focusedIndex = index;
        
        const menuRect = menu.getBoundingClientRect();
        const itemRect = item.getBoundingClientRect();
        
        if (itemRect.bottom > menuRect.bottom) {
          item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        } else if (itemRect.top < menuRect.top) {
          item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      selectItem(dropdown, index) {
        const { items, selectedTextEl, hiddenInput } = dropdown;
        const item = items[index];
        
        if (!item) return;
        
        const value = item.getAttribute('data-value');
        const text = item.textContent.trim();
        
        items.forEach(i => i.classList.remove('is-active'));
        item.classList.add('is-active');
        
        if (selectedTextEl) {
          selectedTextEl.textContent = text;
        }
        
        if (hiddenInput) {
          hiddenInput.value = value;
          const event = new Event('change', { bubbles: true });
          hiddenInput.dispatchEvent(event);
        }
        
        dropdown.selectedIndex = index;
        
        this.close(dropdown);
        
        // Update result display
        document.getElementById('result').textContent = `${value} - ${text}`;
        
        console.log(`‚úì Selected: ${text} (value: ${value})`);
      }

      positionMenu(dropdown) {
        const { trigger, menu, wrapper } = dropdown;
        
        if (!wrapper) return;
        
        const triggerRect = trigger.getBoundingClientRect();
        
        menu.style.top = `${trigger.offsetTop + trigger.offsetHeight}px`;
        menu.style.left = `${trigger.offsetLeft}px`;
        menu.style.width = `${triggerRect.width}px`;
      }
    }

    // Initialize
    new Dropdown();
  </script>
</body>
</html>

